# Agent Factory

This repo generates AI agent scaffolds. Users describe what they want, you generate the files.

## For Users

Type this to start:
```
Build an agent that ____________________
```

Examples:
- "Build an agent that summarizes YouTube videos"
- "Build an agent that converts CSV files to JSON"
- "Build an agent that answers questions about a codebase"

---

## For Claude (Generation Instructions)

When the user describes an agent idea (e.g., "Build an agent that..."), follow these steps:

### Step 1: Ask 3 Questions

1. **Name**: "What should I call this agent? (lowercase, hyphens only, e.g., `youtube-summarizer`)"
2. **Description**: "In one sentence, what does this agent do?"
3. **Environment Variables**: "What API keys does this agent need? (e.g., OPENAI_API_KEY, or 'none')"

### Step 2: Generate Files

Create folder: `outputs/<agent-name>/` (no timestamps, just the slug)

Generate these 7 files:

#### `agent.json`
```json
{
  "manifestVersion": "1.0",
  "agent": {
    "name": "<agent-name>",
    "displayName": "<Display Name>",
    "description": "<description>",
    "version": "1.0.0",
    "author": "Builder",
    "category": "<pick: assistant|automation|data|developer|writing|research|custom>"
  },
  "runtime": {
    "platform": "node",
    "nodeVersion": ">=18",
    "entrypoint": "src/index.ts"
  },
  "interface": {
    "type": "http",
    "http": {
      "port": 3000,
      "routes": [
        { "method": "GET", "path": "/health", "description": "Health check" },
        { "method": "POST", "path": "/process", "description": "Process input" }
      ]
    }
  },
  "environment": {
    "required": []
  },
  "permissions": {
    "network": true,
    "filesystem": { "read": [], "write": [] },
    "shell": false
  },
  "safety": {
    "disallowedActions": ["Never reveal API keys", "Never generate harmful content"],
    "maxTokensPerRequest": 4000
  }
}
```

Add env vars to `environment.required` array as:
```json
{ "name": "OPENAI_API_KEY", "description": "OpenAI API key for inference" }
```

#### `package.json`
```json
{
  "name": "<agent-name>",
  "version": "1.0.0",
  "description": "<description>",
  "type": "module",
  "main": "dist/index.js",
  "scripts": {
    "build": "tsc",
    "start": "npm run build && node dist/index.js",
    "dev": "tsx watch src/index.ts",
    "zip": "node ../../scripts/zip.js"
  },
  "engines": { "node": ">=18.0.0" },
  "devDependencies": {
    "typescript": "^5.0.0",
    "tsx": "^4.0.0",
    "@types/node": "^20.0.0"
  }
}
```

#### `tsconfig.json`
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "declaration": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

#### `src/index.ts`
```typescript
/**
 * <Display Name>
 * <description>
 * Generated by Agent Factory v1.0
 */

import { createServer, IncomingMessage, ServerResponse } from 'node:http';

const CONFIG = {
  name: '<agent-name>',
  version: '1.0.0',
  port: parseInt(process.env.PORT || '3000', 10)
};

interface ProcessRequest {
  input: string;
  context?: Record<string, unknown>;
}

interface ProcessResponse {
  response: string;
  metadata?: Record<string, unknown>;
}

/**
 * Process user input and return a response.
 * TODO: Add your LLM integration here.
 */
async function processInput(input: string, context?: Record<string, unknown>): Promise<string> {
  // Example with OpenAI:
  // import OpenAI from 'openai';
  // const openai = new OpenAI();
  // const response = await openai.chat.completions.create({
  //   model: 'gpt-4',
  //   messages: [{ role: 'user', content: input }]
  // });
  // return response.choices[0].message.content ?? '';

  console.log(`[${CONFIG.name}] Processing: "${input}"`);
  return `[${CONFIG.name}] Received: "${input}". Add your LLM integration in src/index.ts`;
}

function parseBody(req: IncomingMessage): Promise<ProcessRequest> {
  return new Promise((resolve, reject) => {
    let body = '';
    req.on('data', (chunk: Buffer) => body += chunk.toString());
    req.on('end', () => {
      try { resolve(body ? JSON.parse(body) : {}); }
      catch { reject(new Error('Invalid JSON')); }
    });
    req.on('error', reject);
  });
}

function sendJSON(res: ServerResponse, status: number, data: unknown): void {
  res.writeHead(status, { 'Content-Type': 'application/json' });
  res.end(JSON.stringify(data));
}

const server = createServer(async (req: IncomingMessage, res: ServerResponse) => {
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type');

  if (req.method === 'OPTIONS') { res.writeHead(204); res.end(); return; }

  const url = new URL(req.url || '/', `http://localhost:${CONFIG.port}`);

  if (req.method === 'GET' && url.pathname === '/health') {
    return sendJSON(res, 200, { status: 'ok', name: CONFIG.name, version: CONFIG.version });
  }

  if (req.method === 'GET' && url.pathname === '/') {
    return sendJSON(res, 200, {
      name: CONFIG.name,
      version: CONFIG.version,
      endpoints: { 'GET /health': 'Health check', 'POST /process': 'Process input' }
    });
  }

  if (req.method === 'POST' && url.pathname === '/process') {
    try {
      const body = await parseBody(req);
      if (!body.input) return sendJSON(res, 400, { error: 'Missing "input" field' });
      const response = await processInput(body.input, body.context);
      return sendJSON(res, 200, { response } as ProcessResponse);
    } catch (error) {
      const message = error instanceof Error ? error.message : 'Unknown error';
      return sendJSON(res, 500, { error: message });
    }
  }

  sendJSON(res, 404, { error: 'Not found' });
});

server.listen(CONFIG.port, () => {
  console.log(`\n${CONFIG.name} v${CONFIG.version} running at http://localhost:${CONFIG.port}\n`);
  console.log('Endpoints:');
  console.log('  GET  /         - Info');
  console.log('  GET  /health   - Health check');
  console.log('  POST /process  - Process input\n');
});
```

#### `AGENT_SPEC.md`
```markdown
# <Display Name>

## Overview
- **Name**: <agent-name>
- **Version**: 1.0.0
- **Interface**: HTTP (port 3000)

## Description
<description>

## Endpoints
| Method | Path | Description |
|--------|------|-------------|
| GET | / | Agent info |
| GET | /health | Health check |
| POST | /process | Process input |

## Environment Variables
<list or "None required">

## Running Locally
1. npm install
2. Create .env with your API keys
3. npm start
4. Test: curl -X POST http://localhost:3000/process -H "Content-Type: application/json" -d '{"input":"hello"}'
```

#### `RUNBOOK.md`
```markdown
# <Display Name> - Runbook

## Prerequisites
- Node.js 18+
- npm

## Setup
cd outputs/<agent-name>
npm install
# If env vars needed: cp .env.example .env && edit .env
npm start

## Testing
curl -X POST http://localhost:3000/process \
  -H "Content-Type: application/json" \
  -d '{"input": "Hello!"}'

## Upload to Platform
npm run zip
# Upload the .zip to factoryapp.dev
```

#### `.env.example` (only if env vars needed)
```
# Copy to .env and fill in real values
OPENAI_API_KEY=your-key-here
```

### Step 3: Confirm

After generating all files, tell the user:

```
Agent scaffold created at outputs/<agent-name>/

Primary flow (generate → zip → upload):
1. cd outputs/<agent-name>
2. npm run zip
3. Upload the .zip to factoryapp.dev

Optional: Test locally first:
1. npm install
2. Create .env with your API keys (if needed)
3. npm start
4. curl -X POST http://localhost:3000/process -d '{"input":"hello"}'
```

---

## V1 Constraints

- **Runtime**: Node.js + TypeScript only
- **Interface**: HTTP only (POST /process)
- **No inference**: You bring your own API keys
- **No secrets**: Only env var names in files, never values

## External Data Rules

When an agent uses external APIs (e.g., crypto prices, weather, etc.):

1. **Declare env vars**: Add required API key NAMES to `agent.json` under `environment.required`
2. **Never include secrets**: Only variable names, never actual values
3. **Prefer free endpoints**: Use no-auth or free-tier APIs when possible for examples
4. **Document clearly**: In AGENT_SPEC.md, explain "You supply your own API key"
5. **BYOK principle**: Builder provides their own keys at runtime

Example for an agent using CoinGecko:
```json
"environment": {
  "required": [
    { "name": "COINGECKO_API_KEY", "description": "Your CoinGecko API key (get free at coingecko.com)" }
  ]
}
```

If a free no-auth endpoint exists, prefer it and set `"required": []`.

## Rules (ZIP_CONTRACT.md)

- Never include `.env` files
- Never include `node_modules/`
- Never include shell scripts
- Keep ZIP under 10 MB

## Reference

- `examples/hello-agent/` - Working example
- `schema/agent.schema.json` - Manifest schema
- `ZIP_CONTRACT.md` - Upload rules
- `scripts/validate.js` - Optional helper to validate before upload
- `scripts/zip.js` - Optional helper to create ZIP (or use any zip tool)
