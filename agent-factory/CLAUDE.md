# Agent Factory

**Version**: 1.1
**Status**: MANDATORY - Follow these instructions exactly

This repo generates AI agent scaffolds. Users describe what they want, you generate the files.

---

## For Users

Type this to start:
```
Build an agent that ____________________
```

Examples:
- "Build an agent that summarizes YouTube videos"
- "Build an agent that converts CSV files to JSON"
- "Build an agent that answers questions about a codebase"

---

## For Claude (Generation Instructions)

When the user describes an agent idea (e.g., "Build an agent that..."), follow these steps:

### Step 1: Ask 4 Questions

1. **Name**: "What should I call this agent? (lowercase, hyphens only, e.g., `youtube-summarizer`)"
2. **Description**: "In one sentence, what does this agent do?"
3. **Environment Variables**: "What API keys does this agent need? (e.g., OPENAI_API_KEY, or 'none')"
4. **Token Integration**: "Do you want token integration for rewards/payments? (yes/no)"

### Step 2: Generate Files

Create folder: `outputs/<agent-name>/` (no timestamps, just the slug)

Generate these files:

#### Always Generate

| File | Purpose |
|------|---------|
| `agent.json` | Agent manifest |
| `package.json` | Node.js config |
| `tsconfig.json` | TypeScript config |
| `src/index.ts` | HTTP server code |
| `AGENT_SPEC.md` | Agent specification |
| `RUNBOOK.md` | Run instructions |
| `TESTING.md` | Test instructions |
| `LAUNCH_CHECKLIST.md` | Pre-launch checks |
| `FACTORY_IMPORT.md` | Upload instructions |
| `.env.example` | Environment template (if env vars needed) |

#### Generate Only If Token Integration = Yes

| File | Purpose |
|------|---------|
| `TOKEN_INTEGRATION.md` | Token setup guide |
| `src/lib/token.ts` | Token utilities |

---

## File Templates

### `agent.json`
```json
{
  "manifestVersion": "1.0",
  "agent": {
    "name": "<agent-name>",
    "displayName": "<Display Name>",
    "description": "<description>",
    "version": "1.0.0",
    "author": "Builder",
    "category": "<pick: assistant|automation|data|developer|writing|research|custom>"
  },
  "runtime": {
    "platform": "node",
    "nodeVersion": ">=18",
    "entrypoint": "src/index.ts"
  },
  "interface": {
    "type": "http",
    "http": {
      "port": 8080,
      "routes": [
        { "method": "GET", "path": "/health", "description": "Health check" },
        { "method": "POST", "path": "/process", "description": "Process input" }
      ]
    }
  },
  "environment": {
    "required": []
  },
  "permissions": {
    "network": true,
    "filesystem": { "read": [], "write": [] },
    "shell": false
  },
  "safety": {
    "disallowedActions": ["Never reveal API keys", "Never generate harmful content"],
    "maxTokensPerRequest": 4000
  },
  "tokenIntegration": false
}
```

Add env vars to `environment.required` array as:
```json
{ "name": "OPENAI_API_KEY", "description": "OpenAI API key for inference" }
```

If token integration enabled, set `"tokenIntegration": true`.

### `package.json`
```json
{
  "name": "<agent-name>",
  "version": "1.0.0",
  "description": "<description>",
  "type": "module",
  "main": "dist/index.js",
  "scripts": {
    "build": "tsc",
    "start": "npm run build && node dist/index.js",
    "dev": "tsx watch src/index.ts",
    "validate": "node ../../scripts/validate.js"
  },
  "engines": { "node": ">=18.0.0" },
  "devDependencies": {
    "typescript": "^5.0.0",
    "tsx": "^4.0.0",
    "@types/node": "^20.0.0"
  }
}
```

### `tsconfig.json`
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "declaration": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

### `src/index.ts`
```typescript
/**
 * <Display Name>
 * <description>
 * Generated by Agent Factory v1.1
 */

import { createServer, IncomingMessage, ServerResponse } from 'node:http';

const CONFIG = {
  name: '<agent-name>',
  version: '1.0.0',
  port: parseInt(process.env.PORT || '8080', 10)
};

interface ProcessRequest {
  input: string;
  context?: Record<string, unknown>;
}

interface ProcessResponse {
  response: string;
  metadata?: Record<string, unknown>;
}

/**
 * Process user input and return a response.
 * TODO: Add your LLM integration here.
 */
async function processInput(input: string, context?: Record<string, unknown>): Promise<string> {
  // Example with OpenAI:
  // import OpenAI from 'openai';
  // const openai = new OpenAI();
  // const response = await openai.chat.completions.create({
  //   model: 'gpt-4',
  //   messages: [{ role: 'user', content: input }]
  // });
  // return response.choices[0].message.content ?? '';

  console.log(`[${CONFIG.name}] Processing: "${input}"`);
  return `[${CONFIG.name}] Received: "${input}". Add your LLM integration in src/index.ts`;
}

function parseBody(req: IncomingMessage): Promise<ProcessRequest> {
  return new Promise((resolve, reject) => {
    let body = '';
    req.on('data', (chunk: Buffer) => body += chunk.toString());
    req.on('end', () => {
      try { resolve(body ? JSON.parse(body) : {}); }
      catch { reject(new Error('Invalid JSON')); }
    });
    req.on('error', reject);
  });
}

function sendJSON(res: ServerResponse, status: number, data: unknown): void {
  res.writeHead(status, { 'Content-Type': 'application/json' });
  res.end(JSON.stringify(data));
}

const server = createServer(async (req: IncomingMessage, res: ServerResponse) => {
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type');

  if (req.method === 'OPTIONS') { res.writeHead(204); res.end(); return; }

  const url = new URL(req.url || '/', `http://localhost:${CONFIG.port}`);

  if (req.method === 'GET' && url.pathname === '/health') {
    return sendJSON(res, 200, { status: 'ok', name: CONFIG.name, version: CONFIG.version });
  }

  if (req.method === 'GET' && url.pathname === '/') {
    return sendJSON(res, 200, {
      name: CONFIG.name,
      version: CONFIG.version,
      endpoints: { 'GET /health': 'Health check', 'POST /process': 'Process input' }
    });
  }

  if (req.method === 'POST' && url.pathname === '/process') {
    try {
      const body = await parseBody(req);
      if (!body.input) return sendJSON(res, 400, { error: 'Missing "input" field' });
      const response = await processInput(body.input, body.context);
      return sendJSON(res, 200, { response } as ProcessResponse);
    } catch (error) {
      const message = error instanceof Error ? error.message : 'Unknown error';
      return sendJSON(res, 500, { error: message });
    }
  }

  sendJSON(res, 404, { error: 'Not found' });
});

server.listen(CONFIG.port, () => {
  console.log(`\n${CONFIG.name} v${CONFIG.version} running at http://localhost:${CONFIG.port}\n`);
  console.log('Endpoints:');
  console.log('  GET  /         - Info');
  console.log('  GET  /health   - Health check');
  console.log('  POST /process  - Process input\n');
});
```

### `AGENT_SPEC.md`
```markdown
# <Display Name>

## Overview
- **Name**: <agent-name>
- **Version**: 1.0.0
- **Interface**: HTTP (port 8080)

## Description
<description>

## Endpoints
| Method | Path | Description |
|--------|------|-------------|
| GET | / | Agent info |
| GET | /health | Health check |
| POST | /process | Process input |

## Environment Variables
<list or "None required">

## Running Locally
1. npm install
2. Create .env with your API keys (if needed)
3. npm start
4. Test: curl -X POST http://localhost:8080/process -H "Content-Type: application/json" -d '{"input":"hello"}'
```

### `RUNBOOK.md`
```markdown
# <Display Name> - Runbook

**Exact steps to run this agent locally.**

## Prerequisites
- Node.js 18+
- npm

Verify:
\`\`\`bash
node --version   # Should be v18+
npm --version    # Should be v8+
\`\`\`

## Step 1: Install Dependencies
\`\`\`bash
cd outputs/<agent-name>
npm install
\`\`\`

Expected output:
\`\`\`
added XX packages in Xs
\`\`\`

## Step 2: Configure Environment (If Needed)
<If env vars required>
\`\`\`bash
cp .env.example .env
# Edit .env with your API keys
\`\`\`

<If no env vars>
No environment configuration needed.

## Step 3: Start the Agent
\`\`\`bash
npm run dev
\`\`\`

Expected output:
\`\`\`
<agent-name> v1.0.0 running at http://localhost:8080

Endpoints:
  GET  /         - Info
  GET  /health   - Health check
  POST /process  - Process input
\`\`\`

## Step 4: Verify It Works
\`\`\`bash
curl http://localhost:8080/health
\`\`\`

Expected output:
\`\`\`json
{"status":"ok","name":"<agent-name>","version":"1.0.0"}
\`\`\`

## Common Issues

### Port already in use
\`\`\`bash
PORT=3000 npm run dev
\`\`\`

### Missing dependencies
\`\`\`bash
rm -rf node_modules
npm install
\`\`\`
```

### `TESTING.md`
```markdown
# <Display Name> - Testing Guide

**How to verify this agent works correctly.**

## Smoke Tests

### Test 1: Health Check

\`\`\`bash
curl http://localhost:8080/health
\`\`\`

Expected:
\`\`\`json
{"status":"ok","name":"<agent-name>","version":"1.0.0"}
\`\`\`

**PASS criteria:** Returns 200 with status "ok"

### Test 2: Info Endpoint

\`\`\`bash
curl http://localhost:8080/
\`\`\`

Expected:
\`\`\`json
{"name":"<agent-name>","version":"1.0.0","endpoints":{...}}
\`\`\`

**PASS criteria:** Returns 200 with agent info

### Test 3: Process Input

\`\`\`bash
curl -X POST http://localhost:8080/process \\
  -H "Content-Type: application/json" \\
  -d '{"input":"Hello!"}'
\`\`\`

Expected:
\`\`\`json
{"response":"..."}
\`\`\`

**PASS criteria:** Returns 200 with response field

### Test 4: Error Handling

\`\`\`bash
curl -X POST http://localhost:8080/process \\
  -H "Content-Type: application/json" \\
  -d '{}'
\`\`\`

Expected:
\`\`\`json
{"error":"Missing \\"input\\" field"}
\`\`\`

**PASS criteria:** Returns 400 with error message

## Test Summary

| Test | Status |
|------|--------|
| Health Check | [ ] PASS / [ ] FAIL |
| Info Endpoint | [ ] PASS / [ ] FAIL |
| Process Input | [ ] PASS / [ ] FAIL |
| Error Handling | [ ] PASS / [ ] FAIL |

**Overall: [ ] PASS / [ ] FAIL**
```

### `LAUNCH_CHECKLIST.md`
```markdown
# <Display Name> - Launch Checklist

**Complete these steps to prepare your agent for deployment.**

## Pre-Launch

### Code & Build
- [ ] \`npm install\` completes without errors
- [ ] \`npm run dev\` starts server
- [ ] Health check returns 200
- [ ] Process endpoint works
- [ ] All smoke tests pass (see TESTING.md)

### Validation
- [ ] \`npm run validate\` passes
- [ ] No forbidden files present
- [ ] agent.json is valid
- [ ] package.json has correct name

### Documentation
- [ ] AGENT_SPEC.md describes the agent accurately
- [ ] RUNBOOK.md has correct commands
- [ ] .env.example lists all required variables (if any)

## Push to GitHub

- [ ] Initialize git: \`git init\`
- [ ] Add files: \`git add .\`
- [ ] Commit: \`git commit -m "Initial commit"\`
- [ ] Create GitHub repo
- [ ] Push: \`git remote add origin <url> && git push -u origin main\`

## Prepare for Launch

**The Factory Launchpad is not yet publicly live.**

- [ ] Project metadata prepared (name, description)
- [ ] Token details prepared if using token integration (name, symbol, image)
- [ ] Awaiting launchpad availability

## Post-Launch

- [ ] Verify agent is live
- [ ] Test deployed endpoint
- [ ] (If token-enabled) Copy contract address
- [ ] (If token-enabled) Add to .env and redeploy
```

### `FACTORY_IMPORT.md`
```markdown
# <Display Name> - Deployment Preparation Guide

**How to prepare this agent for deployment.**

## Step 1: Validate

\`\`\`bash
npm run validate
\`\`\`

This checks your agent against the Factory Ready Standard.

Expected output:
\`\`\`
PASSED
  Files: 8
  Size: 12.3 KB

Wrote: factory_ready.json
\`\`\`

## Step 2: Push to GitHub

\`\`\`bash
git init
git add .
git commit -m "Initial commit"
git remote add origin https://github.com/your-username/<agent-name>
git push -u origin main
\`\`\`

## Step 3: Prepare for Launch

**The Factory Launchpad is not yet publicly live.**

At this stage, ensure your project is ready:

1. Validation passes (`npm run validate`)
2. Code pushed to GitHub
3. Project metadata prepared (name, description)
4. Token details prepared if applicable (name, symbol, image)

When the Factory Launchpad opens, you will be able to import your project and deploy it.

## Token Configuration (When Launched)

If you enabled token integration, after launching you will:

1. Receive a contract address
2. Add to your `.env`:

\`\`\`bash
TOKEN_CONTRACT_ADDRESS=<your-contract-address>
\`\`\`

3. Push update and redeploy to activate token features

## Troubleshooting

### "Validation fails"
Run \`npm run validate\` locally to see errors.

### "Build fails locally"
Run \`npm run build\` locally to see errors.
```

### `.env.example` (only if env vars needed)
```
# Copy to .env and fill in real values
OPENAI_API_KEY=your-key-here
```

---

## Token Integration Templates

Generate these ONLY if user said "yes" to token integration:

### `TOKEN_INTEGRATION.md`
```markdown
# <Display Name> - Token Integration

**How to configure token integration after launch.**

## Overview

This agent supports token integration for rewards/payments. After launching, you'll receive a contract address to configure.

## Step 1: Prepare for Launch

1. Push your agent to GitHub
2. Ensure validation passes (`npm run validate`)
3. Prepare token details (image, name, symbol, socials)
4. Wait for Factory Launchpad availability
5. After launching, copy your contract address from the confirmation

## Step 2: Configure

Add to your \`.env\` file:
\`\`\`bash
TOKEN_CONTRACT_ADDRESS=<your-contract-address>
\`\`\`

## Step 3: Redeploy

Restart your agent to pick up the new configuration:
\`\`\`bash
npm run dev
\`\`\`

## Verification

Test token endpoint:
\`\`\`bash
curl http://localhost:8080/token/balance?address=<wallet-address>
\`\`\`

## Token Features

This agent includes:
- Token balance checking
- Token-gated endpoints (optional)
- Reward distribution hooks (customize in src/lib/token.ts)

## Dry Run Mode

Before your token is live, the agent runs in "dry run" mode:
- Token checks return mock balances
- No real chain calls are made
- Useful for testing integration logic
```

### `src/lib/token.ts`
```typescript
/**
 * Token Integration Module
 * Provides token utilities for rewards/payments.
 *
 * CONFIGURATION:
 * Set TOKEN_CONTRACT_ADDRESS in .env after launching.
 */

export interface TokenConfig {
  contractAddress: string | null;
  isDryRun: boolean;
}

export function getTokenConfig(): TokenConfig {
  const contractAddress = process.env.TOKEN_CONTRACT_ADDRESS || null;
  return {
    contractAddress,
    isDryRun: !contractAddress || contractAddress === 'dry-run'
  };
}

/**
 * Check token balance for an address.
 * Returns mock balance in dry run mode.
 */
export async function getTokenBalance(walletAddress: string): Promise<number> {
  const config = getTokenConfig();

  if (config.isDryRun) {
    console.log(\`[token] Dry run mode - returning mock balance for \${walletAddress}\`);
    return 1000; // Mock balance for testing
  }

  // TODO: Implement real balance check
  console.log(\`[token] Would check balance for \${walletAddress} on contract \${config.contractAddress}\`);
  return 0;
}

/**
 * Verify wallet has minimum token balance for access.
 */
export async function verifyTokenAccess(walletAddress: string, minimumBalance: number = 0): Promise<boolean> {
  const balance = await getTokenBalance(walletAddress);
  return balance >= minimumBalance;
}
```

---

## Step 3: Confirm

After generating all files, tell the user:

**If WITHOUT tokens:**
```
Agent scaffold created at outputs/<agent-name>/

Token integration: DISABLED (can add later)

Next steps:
1. cd outputs/<agent-name>
2. npm install
3. npm run dev
4. Test: curl http://localhost:8080/health
5. Validate: npm run validate
6. Push to GitHub
7. Prepare project metadata for launch
```

**If WITH tokens:**
```
Agent scaffold created at outputs/<agent-name>/

Token integration: ENABLED

Next steps:
1. cd outputs/<agent-name>
2. npm install
3. npm run dev
4. Test: curl http://localhost:8080/health
5. Validate: npm run validate
6. Push to GitHub
7. Prepare project metadata for launch - fill in Token Details
8. After launch, copy contract address
9. Add TOKEN_CONTRACT_ADDRESS to .env and push update
```

---

## V1 Constraints

- **Runtime**: Node.js + TypeScript only
- **Interface**: HTTP only (POST /process)
- **Port**: 8080 default
- **No inference**: You bring your own API keys
- **No secrets**: Only env var names in files, never values

## External Data Rules

When an agent uses external APIs (e.g., crypto prices, weather, etc.):

1. **Declare env vars**: Add required API key NAMES to `agent.json` under `environment.required`
2. **Never include secrets**: Only variable names, never actual values
3. **Prefer free endpoints**: Use no-auth or free-tier APIs when possible for examples
4. **Document clearly**: In AGENT_SPEC.md, explain "You supply your own API key"
5. **BYOK principle**: Builder provides their own keys at runtime

## Rules (Factory Ready Standard)

- Never include `.env` files (use .env.example instead)
- Never include `node_modules/`
- Never include shell scripts
- Never commit secrets or API keys
- Always push to GitHub before importing

## Reference

- `examples/hello-agent/` - Working example
- `schema/agent.schema.json` - Manifest schema
- `../docs/FACTORY_READY_STANDARD.md` - Quality checklist
- `scripts/validate.js` - Validate before import
