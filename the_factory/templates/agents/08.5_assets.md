# Stage 08.5: Assets & Iconography

## AGENT-NATIVE EXECUTION

You are Claude Code (Opus 4.5) operating under the execution identity defined in CLAUDE.md.

Create comprehensive visual asset specifications based on brand identity and design system for Expo React Native apps.

## BUILD MODE VERIFICATION (CRITICAL)
Stage 08.5 can ONLY be executed via `build <IDEA_ID_OR_NAME>` command:
- Verify invocation came from build mode, not `run app factory`
- Require Stage 01-08 artifacts exist (hard-fail if missing)
- Assert this stage is building ONE SPECIFIC IDEA only
- Hard-fail if executed during batch idea generation

## STANDARDS CONTRACT (MANDATORY)
Read and comply with `standards/mobile_app_best_practices_2026.md`. Your output must include a "Standards Compliance Mapping" section demonstrating Expo asset requirements and platform icon guidelines.

## INPUTS
- Read: `runs/.../ideas/<idea_dir>/stages/stage08.json` (brand identity - PRIMARY)
- Read: `runs/.../ideas/<idea_dir>/stages/stage03.json` (UX design - design tokens)
- Read: `runs/.../ideas/<idea_dir>/uiux/design_tokens.json` (color system)
- Read: `runs/.../ideas/<idea_dir>/meta/idea.json` (canonical idea definition)
- Read: `runs/.../ideas/<idea_dir>/meta/boundary.json` (isolation enforcement)

## OUTPUTS
- Write: `runs/.../ideas/<idea_dir>/stages/stage08.5.json` (validated asset specification)
- Write: `runs/.../ideas/<idea_dir>/outputs/stage08.5_execution.md` (execution log with decisions)
- Write: `runs/.../ideas/<idea_dir>/assets/asset_spec.json` (detailed asset manifest)
- Write: `runs/.../ideas/<idea_dir>/assets/icon_inventory.md` (in-app icon catalog)
- Render: `runs/.../ideas/<idea_dir>/spec/08.5_assets.md` (specification markdown)
- Update: `runs/.../ideas/<idea_dir>/meta/stage_status.json` (progress tracking)

## AUTHORITATIVE REFERENCES (MANDATORY)
You MUST consult current official documentation:

### Expo Asset Requirements
- **Expo App Icons**: Icon must be 1024x1024 PNG, no transparency for iOS, no alpha channel
- **Expo Splash Screen**: Minimum 1284x2778 for modern devices, PNG format
- **Android Adaptive Icons**: Foreground 1024x1024 with safe zone, background can be color or image

### Platform Guidelines
- **iOS App Icon**: No transparency, no rounded corners (system applies them)
- **Android Adaptive Icon**: Foreground in safe zone (centered 66%), background extends to edges
- **In-App Icons**: react-native-svg for resolution-independent icons

## BOUNDARY ENFORCEMENT
This stage must ONLY read from:
- Current idea pack: `runs/.../ideas/<idea_dir>/`
- Global standards: `standards/mobile_app_best_practices_2026.md`

## JSON SCHEMA

```json
{
  "meta": {
    "run_id": "string",
    "idea_id": "string",
    "idea_name": "string",
    "idea_dir": "string",
    "source_root": "string",
    "input_stage_paths": ["array of files read"],
    "boundary_path": "string"
  },
  "asset_specification": {
    "app_icon": {
      "concept": {
        "description": "string (icon concept from brand)",
        "primary_symbol": "string (main visual element)",
        "style": "filled|outline|mixed",
        "background_approach": "solid_color|gradient|pattern"
      },
      "design_rules": {
        "corner_radius": "string (iOS applies automatically, specify design intent)",
        "stroke_weight": "string (if outline style)",
        "safe_zone_compliance": "boolean (centered in 66% for adaptive)",
        "contrast_requirements": "string (must be visible on all backgrounds)"
      },
      "color_mapping": {
        "icon_background": "string (hex from brand palette)",
        "icon_foreground": "string (hex from brand palette)",
        "accent_color": "string (hex, optional)"
      },
      "export_requirements": {
        "ios_icon": {
          "path": "assets/icon.png",
          "size": "1024x1024",
          "format": "PNG",
          "transparency": false
        },
        "android_foreground": {
          "path": "assets/adaptive-icon-foreground.png",
          "size": "1024x1024",
          "format": "PNG",
          "transparency": true,
          "safe_zone": "66% centered"
        },
        "android_background": {
          "type": "color|image",
          "value": "string (hex color or path to image)"
        }
      }
    },
    "splash_screen": {
      "concept": {
        "layout": "centered_logo|branded_full|minimal",
        "animation": "none|fade_in|scale",
        "background_treatment": "solid|gradient"
      },
      "design_rules": {
        "logo_placement": "center",
        "logo_max_width_percent": "number (typically 40-60%)",
        "safe_area_padding": "string"
      },
      "color_mapping": {
        "background_color": "string (hex from brand)",
        "logo_color": "string (hex, if applicable)"
      },
      "export_requirements": {
        "path": "assets/splash.png",
        "minimum_size": "1284x2778",
        "format": "PNG",
        "resize_mode": "contain|cover|native"
      }
    },
    "in_app_icons": {
      "style_system": {
        "icon_style": "outline|filled|duotone",
        "stroke_weight": "string (e.g., '2px', 'medium')",
        "corner_style": "rounded|sharp|mixed",
        "size_variants": ["16", "20", "24", "32"],
        "default_size": "24"
      },
      "color_system": {
        "primary_icon_color": "string (hex from design tokens)",
        "secondary_icon_color": "string (hex)",
        "disabled_icon_color": "string (hex)",
        "active_icon_color": "string (hex)",
        "error_icon_color": "string (hex)"
      },
      "icon_inventory": [
        {
          "name": "string (semantic name, e.g., 'home', 'settings')",
          "purpose": "string (where used in app)",
          "category": "navigation|action|status|domain_specific",
          "required": true
        }
      ],
      "implementation": {
        "library": "react-native-svg",
        "component_pattern": "functional components with size/color props",
        "output_directory": "src/ui/icons/"
      }
    },
    "illustration_guidelines": {
      "style": "string (e.g., 'flat', 'isometric', 'hand-drawn')",
      "color_usage": "string (how brand colors apply to illustrations)",
      "use_cases": ["onboarding", "empty_states", "error_states"],
      "optional": true
    },
    "asset_generation_config": {
      "tooling": {
        "png_generator": "sharp (Node.js)",
        "svg_to_component": "svgr or manual",
        "color_source": "design_tokens.json"
      },
      "deterministic_seed": "string (for reproducible generation)",
      "regeneration_command": "scripts/generate_assets.sh"
    }
  }
}
```

## EXECUTION STEPS

### Phase 1: Brand & Design Token Analysis
1. Read Stage 08 brand identity to extract:
   - Brand name and visual identity
   - Color palette (primary, secondary colors with hex values)
   - Iconography style preferences
   - App icon concept and design elements
2. Read Stage 03 UX design and design_tokens.json to extract:
   - Design token color system
   - Typography scale
   - Spacing system
3. Validate color consistency between brand and design tokens

### Phase 2: App Icon Specification
4. Define app icon concept based on Stage 08 brand_applications.app_icon
5. Specify design rules:
   - Style (filled, outline, mixed)
   - Corner radius intent (iOS applies automatically)
   - Stroke weight for outline elements
   - Safe zone compliance for Android adaptive icon
6. Map colors from brand palette to icon elements
7. Define export requirements:
   - iOS: 1024x1024 PNG, no transparency
   - Android foreground: 1024x1024 PNG, transparency OK, 66% safe zone
   - Android background: color or image

### Phase 3: Splash Screen Specification
8. Define splash screen concept aligned with brand
9. Specify layout rules:
   - Logo placement (typically centered)
   - Maximum logo width percentage
   - Safe area padding
10. Map background and logo colors from brand
11. Define export requirements (minimum 1284x2778 PNG)

### Phase 4: In-App Icon Inventory
12. Determine icon style system:
    - Outline vs filled vs duotone
    - Stroke weight consistency
    - Corner style (rounded/sharp)
    - Size variants (16, 20, 24, 32)
13. Map icon colors to design tokens:
    - Primary, secondary, disabled, active, error colors
14. Create comprehensive icon inventory (MINIMUM 12 ICONS):
    - **Navigation icons**: home, back, menu, close, search
    - **Action icons**: add, edit, delete, save, share
    - **Status icons**: check, error, warning, info
    - **Domain-specific icons**: Based on app category (e.g., warranty/receipt for warranty apps)
15. Document each icon's purpose and usage location

### Phase 5: Implementation Configuration
16. Specify tooling requirements:
    - PNG generation: sharp (Node.js, cross-platform)
    - SVG-to-component: functional React Native components with size/color props
    - Color source: design_tokens.json for consistency
17. Define deterministic regeneration approach
18. Document output directory structure:
    - `assets/` for app icon and splash
    - `src/ui/icons/` for in-app icon components

### Phase 6: Validation & Documentation
19. Validate all color references exist in brand/design tokens
20. Ensure minimum 12 icons in inventory
21. Verify export requirements match Expo specifications
22. Write JSON with complete asset specification
23. Create icon_inventory.md with visual catalog
24. Render human-readable asset specification

## STANDARDS COMPLIANCE MAPPING

### Expo Asset Requirements (MANDATORY)
- **Requirement**: App icon 1024x1024 PNG, splash minimum 1284x2778, adaptive icon with safe zone
- **Implementation**: Export requirements specify exact sizes and formats
- **Validation**: Asset generation script validates dimensions

### Platform Icon Guidelines
- **Requirement**: iOS no transparency, Android adaptive icon safe zone compliance
- **Implementation**: Design rules specify platform-specific requirements
- **Validation**: verify_assets_present.sh checks compliance

### Design System Consistency
- **Requirement**: All asset colors must come from brand palette / design tokens
- **Implementation**: Color mapping explicitly references source tokens
- **Validation**: No hardcoded colors outside design system

### Accessibility
- **Requirement**: Icons must have sufficient contrast and clear meaning
- **Implementation**: Color system includes contrast-compliant variants
- **Validation**: Icon colors meet 4.5:1 contrast minimum

## SUCCESS CRITERIA
Stage 08.5 is complete when:
- [ ] `stage08.5.json` exists and validates against schema
- [ ] `asset_spec.json` contains complete export requirements
- [ ] `icon_inventory.md` lists minimum 12 in-app icons with purposes
- [ ] All colors reference Stage 08 brand palette or design tokens
- [ ] App icon spec includes iOS and Android adaptive variants
- [ ] Splash screen spec meets Expo minimum requirements
- [ ] In-app icon style system is fully defined

## HARD FAILURE CONDITIONS
- Schema validation failure → Write `stage08.5_failure.md` and stop
- Missing Stage 08 brand identity → Write `stage08.5_failure.md` and stop
- Icon inventory has fewer than 12 icons → Write `stage08.5_failure.md` and stop
- Colors not traceable to brand palette → Write `stage08.5_failure.md` and stop
- Export requirements don't meet Expo specifications → Write `stage08.5_failure.md` and stop
- Boundary violation (reading from wrong idea pack) → Write `stage08.5_failure.md` and stop

DO NOT output JSON in chat. Write all artifacts to disk and continue with Stage 09.
