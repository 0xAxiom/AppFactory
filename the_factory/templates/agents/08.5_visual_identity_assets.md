# Stage 08.5: Visual Identity & Assets

## AGENT-NATIVE EXECUTION

You are Claude Code (Opus 4.5) operating under the execution identity defined in CLAUDE.md.

**CRITICAL**: This stage produces PROFESSIONAL, PRODUCT-GRADE visual assets. Assets are part of the product, not build scaffolding. Flat placeholders are FORBIDDEN.

## CORE PRINCIPLES (NON-NEGOTIABLE)

1. **Assets are product, not scaffolding** - Icon and splash are user-facing brand touchpoints
2. **SVG is source of truth** - All visual assets originate as vector graphics
3. **PNGs are derived artifacts** - Rasterized from SVG sources via deterministic process
4. **Flat placeholders are FORBIDDEN** - Single-color backgrounds with text are build failures
5. **Quality must be evaluated and enforced** - Professional design standards apply
6. **Domain relevance is MANDATORY** - Icon must reference app function visually

## BUILD MODE VERIFICATION (CRITICAL)
Stage 08.5 can ONLY be executed via `build <IDEA_ID_OR_NAME>` command:
- Verify invocation came from build mode, not `run app factory`
- Require Stage 01-08 artifacts exist (hard-fail if missing)
- Assert this stage is building ONE SPECIFIC IDEA only
- Hard-fail if executed during batch idea generation

## STANDARDS CONTRACT (MANDATORY)
Read and comply with `standards/mobile_app_best_practices_2026.md`. Your output must include a "Standards Compliance Mapping" section demonstrating Expo asset requirements, platform icon guidelines, and professional visual standards.

## INPUTS
- Read: `runs/.../ideas/<idea_dir>/stages/stage08.json` (brand identity - PRIMARY)
- Read: `runs/.../ideas/<idea_dir>/stages/stage03.json` (UX design - design tokens)
- Read: `runs/.../ideas/<idea_dir>/stages/stage02.json` (product spec - domain context)
- Read: `runs/.../ideas/<idea_dir>/uiux/design_tokens.json` (color system)
- Read: `runs/.../ideas/<idea_dir>/meta/idea.json` (canonical idea definition)
- Read: `runs/.../ideas/<idea_dir>/meta/boundary.json` (isolation enforcement)

## OUTPUTS (ALL MANDATORY)

### Concept & Rationale
- Write: `runs/.../ideas/<idea_dir>/assets/asset_concept.md` (MANDATORY - icon metaphor, domain relevance, emotional tone)

### Vector Assets (SVG — SOURCE OF TRUTH)
- Write: `runs/.../ideas/<idea_dir>/assets/svg/icon.svg`
- Write: `runs/.../ideas/<idea_dir>/assets/svg/adaptive-icon-foreground.svg`
- Write: `runs/.../ideas/<idea_dir>/assets/svg/adaptive-icon-background.svg`
- Write: `runs/.../ideas/<idea_dir>/assets/svg/splash.svg`

### Raster Assets (Generated from SVG)
- Write: `runs/.../ideas/<idea_dir>/app/assets/icon.png` (1024×1024)
- Write: `runs/.../ideas/<idea_dir>/app/assets/adaptive-icon.png` (1024×1024)
- Write: `runs/.../ideas/<idea_dir>/app/assets/adaptive-icon-foreground.png` (1024×1024)
- Write: `runs/.../ideas/<idea_dir>/app/assets/adaptive-icon-background.png` (1024×1024)
- Write: `runs/.../ideas/<idea_dir>/app/assets/splash.png` (1284×2778 minimum)
- Write: `runs/.../ideas/<idea_dir>/app/assets/favicon.png` (48×48 or 64×64)

### Quality Checklist
- Write: `runs/.../ideas/<idea_dir>/assets/assets_quality_checklist.md` (MANDATORY - silhouette test, domain symbolism, contrast, platform compliance)

### Stage Artifacts
- Write: `runs/.../ideas/<idea_dir>/stages/stage08.5.json` (validated asset specification)
- Write: `runs/.../ideas/<idea_dir>/outputs/stage08.5_execution.md` (execution log with decisions)
- Render: `runs/.../ideas/<idea_dir>/spec/08.5_visual_identity_assets.md` (specification markdown)
- Update: `runs/.../ideas/<idea_dir>/meta/stage_status.json` (progress tracking)

## ASSET CONCEPT DOCUMENT (MANDATORY)

`asset_concept.md` MUST include:

```markdown
# Visual Identity Concept

## App Context
- **App Name**: [from Stage 08]
- **App Domain**: [from Stage 02 - e.g., "paranormal investigation", "fitness tracking"]
- **Target Audience**: [from Stage 02]
- **Brand Personality**: [from Stage 08]

## Icon Design Philosophy

### Primary Metaphor
[Describe the visual symbol used and WHY it represents the app]
- **Symbol**: [e.g., "Stylized waveform with spectral gradient"]
- **Domain Connection**: [How symbol relates to app function]
- **Distinctiveness**: [Why this won't be confused with competitors]

### NOT Typography-Only Justification
[If icon contains text, explain why text is supplementary to symbolic element]
- Icons MUST have a symbolic visual element
- Text-only icons (single letter, wordmark) are FORBIDDEN unless:
  - The app IS a text/writing tool AND
  - The typography IS the product feature
  - Even then, text must have significant visual treatment

### Emotional Tone
[What feeling should the icon evoke?]
- Primary emotion: [e.g., "Professional credibility", "Energetic motivation"]
- Secondary emotions: [e.g., "Mysterious intrigue", "Calm focus"]

### Visual Do's
- [e.g., "Use gradient to suggest depth and quality"]
- [e.g., "Maintain recognizable silhouette at 29×29pt"]
- [e.g., "Apply brand accent color as focal point"]

### Visual Don'ts
- [e.g., "No photographic elements - vector only"]
- [e.g., "No thin strokes that disappear at small sizes"]
- [e.g., "No text smaller than 30% of icon area"]

### Design References
[Describe style references - do NOT include URLs]
- [e.g., "Instrument panel aesthetic from professional audio apps"]
- [e.g., "Minimal geometric style from premium productivity apps"]
- [e.g., "Dark mode native app icon conventions"]

## Splash Screen Philosophy

### Layout Approach
[Describe splash screen design]
- NOT just flat color + centered logo
- Must include branded visual treatment
- Examples of acceptable approaches:
  - Gradient background with branded elements
  - Subtle pattern or texture with logo
  - Visual elements that extend brand identity

### Rejected Approaches
- ❌ Single solid color background with centered logo
- ❌ Plain white/black background
- ❌ Generic "loading" appearance

## Color Application
[How brand colors are applied to assets]
- Primary color usage: [where and how]
- Secondary color usage: [where and how]
- Background treatment: [solid/gradient/pattern]

## Platform Considerations
- **iOS**: [specific considerations]
- **Android Adaptive**: [safe zone compliance, background handling]
```

## SVG REQUIREMENTS (MANDATORY)

All SVG files MUST:

1. **Be true vector graphics**
   - No embedded raster images (`<image>` tags with base64)
   - Use `<path>`, `<circle>`, `<rect>`, `<polygon>`, `<g>` elements
   - Gradients allowed via `<linearGradient>`, `<radialGradient>`

2. **Be layered and organized**
   - Meaningful group (`<g>`) structure
   - Logical layer ordering (background → mid → foreground)
   - Clean, readable markup

3. **Use brand colors from Stage 08**
   - Colors must trace to `visual_identity.color_palette`
   - No arbitrary colors not in brand system

4. **Be resolution-independent**
   - ViewBox properly defined
   - Scales cleanly to any size

5. **NOT be text-only** (unless explicitly justified)
   - Must contain symbolic visual element
   - Text permitted only as supplement to symbol
   - Single letter/wordmark icons FORBIDDEN

### SVG Template Structure
```xml
<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
  <defs>
    <!-- Gradients, patterns, filters -->
  </defs>
  <g id="background">
    <!-- Background layer -->
  </g>
  <g id="elements">
    <!-- Visual elements layer -->
  </g>
  <g id="foreground">
    <!-- Foreground elements -->
  </g>
</svg>
```

## RASTERIZATION REQUIREMENTS (MANDATORY)

### Process
1. Read SVG source from `assets/svg/`
2. Rasterize to PNG using deterministic toolchain
3. Validate output meets specifications
4. Write to `app/assets/`

### Toolchain (MANDATORY - No Guessing)
- **Primary**: Node.js `sharp` library
- **Fallback**: macOS `sips` (only if sharp unavailable)
- **FORBIDDEN**: Random tool discovery, ImageMagick guessing

### Rasterization Script
```bash
scripts/rasterize_svg_assets.sh <idea_dir>
```

### Output Specifications

| Asset | Dimensions | Format | Notes |
|-------|-----------|--------|-------|
| icon.png | 1024×1024 | PNG | No transparency (iOS) |
| adaptive-icon.png | 1024×1024 | PNG | Full icon for fallback |
| adaptive-icon-foreground.png | 1024×1024 | PNG | Transparency OK, 66% safe zone |
| adaptive-icon-background.png | 1024×1024 | PNG | Or solid color reference |
| splash.png | 1284×2778 (min) | PNG | Portrait orientation |
| favicon.png | 48×48 or 64×64 | PNG | Web/PWA use |

## ASSETS QUALITY CHECKLIST (MANDATORY)

`assets_quality_checklist.md` MUST include:

```markdown
# Assets Quality Checklist

**App**: [App Name]
**Generated**: [ISO timestamp]
**Stage**: 08.5 Visual Identity & Assets

## Icon Quality Assessment

### Silhouette Test
- [ ] Icon recognizable at 29×29pt (iOS Settings size)
- [ ] Icon silhouette distinguishable from competitors
- [ ] Key visual elements visible at small size
- **Verdict**: PASS / FAIL

### Domain Symbolism Check
- [ ] Icon visually references app's domain/function
- [ ] Symbol meaning is intuitive to target audience
- [ ] Icon is NOT generic (could apply to any app)
- **Verdict**: PASS / FAIL

### Typography Assessment
- [ ] Icon is NOT text-only (letter/wordmark)
- [ ] OR: Text-only justified in asset_concept.md with rationale
- [ ] Any text is supplementary to symbolic element
- **Verdict**: PASS / FAIL / JUSTIFIED_EXCEPTION

### Contrast & Accessibility
- [ ] Icon readable on light backgrounds
- [ ] Icon readable on dark backgrounds
- [ ] Primary elements meet 4.5:1 contrast minimum
- **Verdict**: PASS / FAIL

### Light/Dark Mode Considerations
- [ ] Icon works in iOS light mode app grid
- [ ] Icon works in iOS dark mode app grid
- [ ] Icon works on Android varied wallpapers
- **Verdict**: PASS / FAIL

### Platform Compliance

#### iOS Compliance
- [ ] icon.png is exactly 1024×1024
- [ ] No transparency in icon.png
- [ ] No pre-applied rounded corners
- **Verdict**: PASS / FAIL

#### Android Compliance
- [ ] Adaptive icon foreground respects 66% safe zone
- [ ] Key elements centered within safe zone
- [ ] Background appropriate (color or image)
- **Verdict**: PASS / FAIL

## Splash Screen Quality Assessment

### Visual Treatment
- [ ] Splash is NOT flat color + centered logo only
- [ ] Splash has branded visual treatment (gradient/pattern/elements)
- [ ] Splash feels cohesive with app brand
- **Verdict**: PASS / FAIL

### Technical Compliance
- [ ] splash.png meets 1284×2778 minimum dimensions
- [ ] Logo/elements properly centered for resize modes
- [ ] Safe areas respected for varied device sizes
- **Verdict**: PASS / FAIL

## File Validation

| Asset | Exists | Size (bytes) | Dimensions | Format Valid |
|-------|--------|-------------|------------|--------------|
| icon.png | ✓/✗ | [size] | [dims] | ✓/✗ |
| adaptive-icon.png | ✓/✗ | [size] | [dims] | ✓/✗ |
| adaptive-icon-foreground.png | ✓/✗ | [size] | [dims] | ✓/✗ |
| adaptive-icon-background.png | ✓/✗ | [size] | [dims] | ✓/✗ |
| splash.png | ✓/✗ | [size] | [dims] | ✓/✗ |
| favicon.png | ✓/✗ | [size] | [dims] | ✓/✗ |

### Size Thresholds (Minimum)
- icon.png: 10 KB minimum (rejects empty/placeholder)
- adaptive-icon-foreground.png: 5 KB minimum
- splash.png: 20 KB minimum
- favicon.png: 500 bytes minimum

## Overall Assessment

**ICON**: [ ] PASS / [ ] FAIL
**SPLASH**: [ ] PASS / [ ] FAIL
**FILES**: [ ] PASS / [ ] FAIL

**Stage 08.5 Status**: READY FOR STAGE 09 / BLOCKED - QUALITY FAILURE
```

## JSON SCHEMA

```json
{
  "meta": {
    "run_id": "string",
    "idea_id": "string",
    "idea_name": "string",
    "idea_dir": "string",
    "source_root": "string",
    "input_stage_paths": ["array of files read"],
    "boundary_path": "string",
    "generated_at": "ISO timestamp"
  },
  "visual_identity": {
    "icon_concept": {
      "primary_metaphor": "string (what the icon represents)",
      "domain_connection": "string (how it relates to app function)",
      "emotional_tone": ["string (emotions evoked)"],
      "is_typography_only": false,
      "typography_justification": "string or null"
    },
    "splash_concept": {
      "layout_approach": "string (gradient|pattern|branded_elements)",
      "is_flat_placeholder": false,
      "visual_treatment": "string (description of treatment)"
    },
    "color_application": {
      "primary_color": "string (hex from Stage 08)",
      "secondary_color": "string (hex from Stage 08)",
      "background_treatment": "solid|gradient|pattern"
    }
  },
  "svg_sources": {
    "icon": {
      "path": "assets/svg/icon.svg",
      "has_embedded_raster": false,
      "layer_count": "number",
      "uses_brand_colors": true
    },
    "adaptive_foreground": {
      "path": "assets/svg/adaptive-icon-foreground.svg",
      "safe_zone_compliant": true
    },
    "adaptive_background": {
      "path": "assets/svg/adaptive-icon-background.svg",
      "type": "image|color_reference"
    },
    "splash": {
      "path": "assets/svg/splash.svg",
      "is_flat_placeholder": false
    }
  },
  "rasterization": {
    "toolchain": "sharp|sips",
    "outputs": [
      {
        "source_svg": "string",
        "output_png": "string",
        "dimensions": "string",
        "file_size_bytes": "number"
      }
    ],
    "all_valid": true
  },
  "quality_assessment": {
    "silhouette_test": "pass|fail",
    "domain_symbolism": "pass|fail",
    "typography_check": "pass|fail|justified_exception",
    "contrast_accessibility": "pass|fail",
    "platform_compliance_ios": "pass|fail",
    "platform_compliance_android": "pass|fail",
    "splash_visual_treatment": "pass|fail",
    "file_validation": "pass|fail",
    "overall_status": "pass|fail"
  }
}
```

## EXECUTION STEPS

### Phase 1: Context Analysis
1. Read Stage 02 product spec to understand:
   - App domain and function
   - Target audience
   - Core value proposition
2. Read Stage 08 brand identity to extract:
   - Brand name and positioning
   - Color palette with hex values
   - Visual identity direction
   - App icon concept from brand_applications
3. Read design tokens for color system consistency

### Phase 2: Icon Concept Development
4. **Determine icon metaphor**:
   - What visual symbol represents the app's function?
   - How does it connect to the domain (NOT generic)?
   - Example: EVP analyzer → waveform/spectrogram icon
   - Example: Fitness tracker → dynamic motion/heartbeat icon
   - Example: Recipe app → stylized ingredient/chef icon

5. **Validate against typography-only rule**:
   - Is the icon primarily symbolic? → PROCEED
   - Is the icon a single letter or wordmark? → REQUIRES JUSTIFICATION
   - If text-only cannot be justified → REDESIGN

6. **Document in asset_concept.md**:
   - Write complete concept rationale
   - Include visual do's and don'ts
   - Reference style direction (no URLs)

### Phase 3: SVG Creation
7. **Create icon.svg**:
   - Design using brand colors
   - Include gradient/depth for quality feel
   - Ensure silhouette works at small sizes
   - NO embedded raster images
   - NO text-only designs

8. **Create adaptive-icon-foreground.svg**:
   - Place key elements in 66% centered safe zone
   - Transparency allowed
   - Works on any background color

9. **Create adaptive-icon-background.svg**:
   - Solid color, gradient, or pattern
   - Extends to edges for adaptive icon system

10. **Create splash.svg**:
    - NOT flat color + centered logo
    - Include branded visual treatment:
      - Gradient background
      - Subtle pattern or texture
      - Brand elements or shapes
    - Logo/mark properly positioned

### Phase 4: Rasterization
11. **Run rasterization script**:
    ```bash
    scripts/rasterize_svg_assets.sh <idea_dir>
    ```

12. **Validate all outputs**:
    - Check file exists
    - Check dimensions match spec
    - Check file size exceeds minimum threshold
    - Check PNG magic bytes valid
    - Check IDAT chunk present

### Phase 5: Quality Assessment
13. **Complete quality checklist**:
    - Run silhouette test (29×29pt visibility)
    - Verify domain symbolism
    - Check contrast/accessibility
    - Verify platform compliance
    - Assess splash visual treatment

14. **Write assets_quality_checklist.md**:
    - Document all test results
    - Mark PASS/FAIL for each criterion
    - Determine overall status

### Phase 6: Validation & Documentation
15. **Validate all requirements met**:
    - All SVG sources exist
    - All PNG outputs valid
    - Quality checklist passes
    - No typography-only violations

16. **Write stage artifacts**:
    - stage08.5.json with complete specification
    - stage08.5_execution.md with decision log
    - Update stage_status.json

## HARD FAILURE CONDITIONS (BUILD-BLOCKING)

Stage 08.5 MUST fail immediately if ANY of these are true:

### 1. Typography-Only Icon (WITHOUT Explicit Justification)
```
FAILURE: Icon is typographic-only without justified exception
- Icon consists of single letter or wordmark
- No symbolic visual element present
- asset_concept.md lacks typography justification
ACTION: Redesign icon with symbolic element
```

### 2. Icon Does Not Reference App Domain
```
FAILURE: Icon lacks domain relevance
- Icon is generic (could apply to any app)
- No visual connection to app function
- Symbol meaning unclear to target audience
ACTION: Redesign icon with domain-specific metaphor
```

### 3. PNG Below Minimum Size Threshold
```
FAILURE: Asset file size below minimum
- icon.png < 10 KB
- splash.png < 20 KB
- adaptive-icon-foreground.png < 5 KB
- favicon.png < 500 bytes
ACTION: Regenerate assets with proper visual content
```

### 4. PNG Invalid or Corrupt
```
FAILURE: PNG file invalid
- Missing PNG magic bytes (89 50 4E 47 0D 0A 1A 0A)
- Missing IDAT chunk (no pixel data)
- MIME type not image/png
ACTION: Regenerate assets with valid rasterization
```

### 5. Splash Screen is Flat Placeholder
```
FAILURE: Splash is flat color + centered logo only
- Single solid color background
- Only element is centered logo/text
- No gradient, pattern, or branded visual treatment
ACTION: Redesign splash with visual treatment
```

### 6. SVGs Not Used as Source
```
FAILURE: No SVG source files
- assets/svg/ directory missing
- SVG files not created
- PNGs generated without vector source
ACTION: Create SVG sources before rasterization
```

### 7. Assets Resemble Generic Templates
```
FAILURE: Generic/placeholder assets detected
- Stock icon appearance
- Default Expo/React Native placeholder style
- No brand identity applied
ACTION: Create custom assets aligned with Stage 08 brand
```

### 8. Embedded Raster in SVG
```
FAILURE: SVG contains embedded raster images
- <image> tag with base64 data detected
- SVG is not true vector
ACTION: Recreate SVG using vector elements only
```

## BOUNDARY ENFORCEMENT
This stage must ONLY read from:
- Current idea pack: `runs/.../ideas/<idea_dir>/`
- Global standards: `standards/mobile_app_best_practices_2026.md`

## STANDARDS COMPLIANCE MAPPING

### Expo Asset Requirements (MANDATORY)
- **Requirement**: App icon 1024×1024 PNG, splash minimum 1284×2778, adaptive icon safe zone
- **Implementation**: Rasterization produces exact sizes from SVG sources
- **Validation**: Dimension and format verification in quality checklist

### Platform Guidelines (MANDATORY)
- **Requirement**: iOS no transparency, Android adaptive icon safe zone
- **Implementation**: Separate iOS icon and Android adaptive foreground/background
- **Validation**: Platform compliance checks in quality checklist

### Professional Visual Standards (MANDATORY)
- **Requirement**: Assets reflect premium product quality
- **Implementation**: SVG-first workflow, domain-relevant design, anti-placeholder enforcement
- **Validation**: Quality assessment with hard failure on generic/placeholder detection

### Brand Consistency (MANDATORY)
- **Requirement**: All assets use Stage 08 brand colors and visual identity
- **Implementation**: Color mapping from brand palette, concept aligned with brand personality
- **Validation**: Color traceability in SVG sources, brand alignment in concept doc

## SUCCESS CRITERIA
Stage 08.5 is complete when:
- [ ] `asset_concept.md` documents icon metaphor and domain relevance
- [ ] All SVG sources exist in `assets/svg/` directory
- [ ] SVGs are true vectors (no embedded raster)
- [ ] All PNG outputs exist and meet size/dimension specs
- [ ] `assets_quality_checklist.md` shows all tests PASS
- [ ] Icon is NOT typography-only (or has justified exception)
- [ ] Splash is NOT flat color + centered logo
- [ ] `stage08.5.json` validates against schema
- [ ] Overall quality assessment is PASS

## DOWNSTREAM INTEGRATION

Stage 08.5 outputs feed directly into Stage 10:
- `app/assets/icon.png` → app.json icon reference
- `app/assets/adaptive-icon-foreground.png` → app.json adaptiveIcon
- `app/assets/splash.png` → app.json splash reference
- `assets_quality_checklist.md` → Stage 10 pre-build validation

Stage 10 MUST verify Stage 08.5 quality checklist passes before build.

DO NOT output JSON in chat. Write all artifacts to disk and continue with Stage 09.
