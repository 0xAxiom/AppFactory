# Stage 09.2: Policy Page Generation

## AGENT-NATIVE EXECUTION

You are Claude Code (Opus 4.5) operating under the execution identity defined in CLAUDE.md.

Generate complete, standards-aligned privacy policy artifacts that meet Apple App Store and Google Play requirements for public accessibility and specific disclosure of data practices.

## MANDATORY COMPLIANCE REQUIREMENTS

### Apple App Store Requirements
- Privacy policy URL MUST be publicly accessible
- Privacy policy MUST be available before app submission
- Must disclose data collection, use, and sharing practices

### Google Play Requirements
- Privacy policy link REQUIRED on store listing AND within the app
- Must specifically address user privacy
- Must be accessible from a web browser

### RevenueCat/Purchase Data
- If RevenueCat is integrated, policy MUST disclose:
  - Purchase history processing
  - Subscription status tracking
  - Anonymous user identification

## INPUTS

Read from idea pack directory:
- `runs/.../ideas/<idea_dir>/stages/stage02.json` - App features and data handling
- `runs/.../ideas/<idea_dir>/stages/stage04.json` - Monetization (RevenueCat usage)
- `runs/.../ideas/<idea_dir>/stages/stage05.json` - Technical architecture (storage, APIs)
- `runs/.../ideas/<idea_dir>/stages/stage08.json` - Brand identity (developer name)
- `runs/.../ideas/<idea_dir>/stages/stage09.json` - Release planning (support email)
- `runs/.../ideas/<idea_dir>/app/_contract/build_contract.json` - Synthesized requirements

## OUTPUTS

Write to idea pack directory:
- `runs/.../ideas/<idea_dir>/stages/stage09.2.json` - Policy data artifact
- `runs/.../ideas/<idea_dir>/outputs/stage09.2_execution.md` - Execution log

## JSON SCHEMA

```json
{
  "stage": "09.2",
  "stage_name": "Policy Page Generation",
  "meta": {
    "run_id": "string",
    "idea_id": "string",
    "idea_dir": "string",
    "boundary_path": "string"
  },
  "policy_data": {
    "app_name": "string",
    "developer_entity_name": "string (from stage08 brand or 'Second Order Co.')",
    "support_email": "string (from stage09 or 'support@secondorderco.com')",
    "policy_slug": "string (kebab-case, e.g., 'evp-analyzer-privacy')",
    "policy_url": "string (https://secondorderco.com/<policy_slug>)",
    "effective_date": "ISO date string"
  },
  "data_practices": {
    "data_collected": [
      {
        "category": "string (e.g., 'Usage Data', 'Audio Recordings', 'None')",
        "description": "string",
        "stored_locally": "boolean",
        "stored_cloud": "boolean",
        "shared_externally": "boolean"
      }
    ],
    "data_not_collected": ["string array of explicitly NOT collected data types"],
    "retention_policy": "string (e.g., 'Data stored locally until user deletes or uninstalls')",
    "deletion_mechanism": "string (e.g., 'In-app deletion + uninstall removes all data')"
  },
  "permissions": [
    {
      "permission": "string (e.g., 'Microphone', 'Camera', 'Location')",
      "purpose": "string (clear user-facing explanation)",
      "required": "boolean"
    }
  ],
  "third_party_processors": [
    {
      "name": "string (e.g., 'RevenueCat')",
      "purpose": "string (e.g., 'Subscription management and purchase processing')",
      "data_shared": "string (e.g., 'Anonymous user ID, purchase history')",
      "privacy_policy_url": "string"
    }
  ],
  "user_rights": {
    "access": "string (how users access their data)",
    "deletion": "string (how users delete their data)",
    "opt_out": "string (opt-out mechanisms if any)",
    "contact": "string (how to contact for privacy concerns)"
  },
  "compliance_flags": {
    "gdpr_applicable": "boolean",
    "ccpa_applicable": "boolean",
    "coppa_applicable": "boolean (typically false for non-child apps)",
    "app_tracking_transparency": "boolean (iOS ATT if applicable)"
  }
}
```

## EXECUTION STEPS

### Phase 1: Data Collection Analysis

1. **Read Stage 02 Product Spec**:
   - Identify core features that handle user data
   - Determine what data types are created/stored
   - Note any cloud sync or sharing features

2. **Read Stage 04 Monetization**:
   - Check for RevenueCat integration → MUST disclose
   - Identify subscription/purchase data handling
   - Note any analytics requirements

3. **Read Stage 05 Architecture**:
   - Identify local storage (SQLite, AsyncStorage)
   - Identify cloud storage (if any)
   - Note third-party SDKs that process data

4. **Read Stage 08 Brand**:
   - Extract developer entity name
   - Use for policy attribution

5. **Read Stage 09 Release**:
   - Extract support email
   - Extract app name for policy title

### Phase 2: Permission Mapping

Map app.json/app.config.js permissions to policy disclosures:

| Permission | Policy Disclosure Required |
|------------|---------------------------|
| RECORD_AUDIO / NSMicrophoneUsageDescription | Audio recording purpose |
| CAMERA / NSCameraUsageDescription | Camera access purpose |
| ACCESS_FINE_LOCATION / NSLocationWhenInUseUsageDescription | Location data handling |
| READ_EXTERNAL_STORAGE | File access purpose |
| WRITE_EXTERNAL_STORAGE | File storage purpose |

### Phase 3: Third-Party Processor Inventory

For each SDK/service used, document:

**RevenueCat** (if present):
- Name: RevenueCat, Inc.
- Purpose: Subscription management and purchase processing
- Data Shared: Anonymous user identifier, purchase transactions, subscription status
- Privacy Policy: https://www.revenuecat.com/privacy

**Expo/React Native** (always present):
- Name: Expo
- Purpose: App development framework
- Data Shared: Crash reports (if expo-updates enabled)
- Privacy Policy: https://expo.dev/privacy

**Firebase** (if present):
- Name: Google Firebase
- Purpose: Analytics and crash reporting
- Data Shared: Usage analytics, crash logs, device information
- Privacy Policy: https://firebase.google.com/support/privacy

### Phase 4: Generate Policy Slug

Create kebab-case slug from app name:
- "EVP Analyzer" → "evp-analyzer-privacy"
- "MemeVault" → "memevault-privacy"
- "FocusFlow" → "focusflow-privacy"

Full URL: `https://secondorderco.com/<policy_slug>`

### Phase 5: Write Stage Artifact

Generate complete `stage09.2.json` with all policy data.

### Phase 6: Write Execution Log

Document:
- Data sources analyzed
- Permissions identified
- Third-party processors detected
- Policy decisions made

## DATA PRACTICE TEMPLATES

### Offline-First Apps (No Cloud)
```json
{
  "data_collected": [
    {
      "category": "App Usage Data",
      "description": "Your interactions within the app to provide core functionality",
      "stored_locally": true,
      "stored_cloud": false,
      "shared_externally": false
    }
  ],
  "data_not_collected": [
    "Personal identification information",
    "Contact information",
    "Location data",
    "Browsing history"
  ],
  "retention_policy": "All data is stored locally on your device. Uninstalling the app removes all data.",
  "deletion_mechanism": "Delete data within the app settings or uninstall the app to remove all data."
}
```

### Apps with RevenueCat
```json
{
  "third_party_processors": [
    {
      "name": "RevenueCat, Inc.",
      "purpose": "Manage subscriptions and process in-app purchases",
      "data_shared": "Anonymous app-specific user identifier, purchase transactions, subscription status",
      "privacy_policy_url": "https://www.revenuecat.com/privacy"
    }
  ]
}
```

### Apps with Audio Recording
```json
{
  "permissions": [
    {
      "permission": "Microphone",
      "purpose": "Record audio for [specific feature, e.g., 'EVP investigation sessions']",
      "required": true
    }
  ],
  "data_collected": [
    {
      "category": "Audio Recordings",
      "description": "Audio files you create using the recording feature",
      "stored_locally": true,
      "stored_cloud": false,
      "shared_externally": false
    }
  ]
}
```

## FAILURE CONDITIONS

Stage 09.2 MUST fail if:
- App name cannot be determined
- Developer entity cannot be determined
- Support email cannot be determined
- Permissions in app config are not mapped to policy disclosures
- RevenueCat is detected but not included in third-party processors

## STAGE DEPENDENCIES

- **Requires**: Stages 02, 04, 05, 08, 09 completed
- **Enables**: Stage 10 policy generation gate

## IMPORTANT NOTES

- Policy text must be accurate to actual app behavior
- Do NOT claim data is not collected if it is
- Do NOT omit third-party processors that handle user data
- Policy slug must be unique and URL-safe
- Effective date should be build date

---

*Stage 09.2 feeds into Stage 10's policy generation gate.*
