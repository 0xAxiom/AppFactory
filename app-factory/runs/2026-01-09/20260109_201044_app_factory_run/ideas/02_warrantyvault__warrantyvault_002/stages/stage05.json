{
  "meta": {
    "run_id": "20260109_201044_app_factory_run",
    "idea_id": "warrantyvault_002",
    "idea_name": "WarrantyVault",
    "idea_dir": "02_warrantyvault__warrantyvault_002",
    "source_root": "runs/2026-01-09/20260109_201044_app_factory_run/ideas/02_warrantyvault__warrantyvault_002/",
    "input_stage_paths": [
      "runs/2026-01-09/20260109_201044_app_factory_run/ideas/02_warrantyvault__warrantyvault_002/stages/stage02.json",
      "runs/2026-01-09/20260109_201044_app_factory_run/ideas/02_warrantyvault__warrantyvault_002/stages/stage02.7.json",
      "runs/2026-01-09/20260109_201044_app_factory_run/ideas/02_warrantyvault__warrantyvault_002/stages/stage03.json",
      "runs/2026-01-09/20260109_201044_app_factory_run/ideas/02_warrantyvault__warrantyvault_002/stages/stage04.json"
    ],
    "boundary_path": "runs/2026-01-09/20260109_201044_app_factory_run/ideas/02_warrantyvault__warrantyvault_002/meta/boundary.json"
  },
  "technical_architecture": {
    "technology_stack": {
      "framework": {
        "react_native_version": "0.76.x",
        "expo_sdk_version": "52",
        "rationale": "Expo SDK 52 is the current stable release with New Architecture enabled by default. React Native 0.76 includes 15x faster Metro resolution and improved performance. Managed workflow simplifies dependency management."
      },
      "navigation": {
        "library": "expo-router",
        "version": "^4.0.0",
        "routing_strategy": "File-based routing with tabs layout. Three primary tabs (Dashboard, Add, Settings) with modal screens for item detail and paywall. Stack navigation within tabs for drill-down."
      },
      "state_management": {
        "approach": "context",
        "rationale": "App has simple state requirements: item list, subscription status, and user preferences. React Context with useReducer provides sufficient capability without external dependencies. Avoids Redux/Zustand overhead for this scope.",
        "data_flow_pattern": "Provider wraps app root. ItemsContext manages warranty items. SubscriptionContext manages entitlement state. PreferencesContext handles notification settings. Each context is independent to minimize re-renders."
      },
      "ui_library": {
        "primary": "React Native core components",
        "components": ["View", "Text", "FlatList", "TouchableOpacity", "Modal", "ScrollView", "Image"],
        "customization_approach": "Custom themed components built on core primitives. Design tokens define spacing, colors, typography. No external UI library to minimize bundle size and maintain full control."
      }
    },
    "data_architecture": {
      "local_storage": {
        "primary": "async_storage",
        "rationale": "AsyncStorage handles structured JSON data for items, categories, and preferences. Proven reliability with Expo. Items stored as JSON array with up to ~6MB capacity (sufficient for 500+ items with metadata).",
        "data_structure": "Items keyed by '@warrantyvault/items'. Settings keyed by '@warrantyvault/settings'. Each item has UUID, timestamps, and category references. Images stored separately via expo-file-system."
      },
      "cloud_sync": {
        "approach": "firebase",
        "rationale": "Firebase offers free tier sufficient for MVP. Firestore provides real-time sync capability for premium users. Firebase Auth supports anonymous authentication for seamless upgrade path.",
        "sync_strategy": "Premium only. Local-first with background sync. Conflict resolution via last-write-wins with client timestamp. User can force sync from settings."
      },
      "offline_capability": {
        "strategy": "Local-first architecture. All core features work offline. Cloud sync is additive, not required.",
        "cached_data": ["warranty_items", "receipt_images", "product_photos", "user_preferences", "notification_schedule"],
        "conflict_resolution": "Last-write-wins with device timestamp for item updates. Image uploads queued when offline, processed on reconnect."
      }
    },
    "subscription_integration": {
      "revenuecat_sdk": {
        "version": "^9.0.0",
        "configuration": "Configure early in app lifecycle (App.tsx). Platform-specific API keys from environment variables. Debug logging enabled in development only. Anonymous user ID until explicit login.",
        "entitlement_handling": "Single 'premium' entitlement gates all premium features. Check entitlement via Purchases.getCustomerInfo(). Cache entitlement state in SubscriptionContext for offline access."
      },
      "purchase_flow": {
        "presentation": "Modal paywall triggered by: (1) Settings upgrade button, (2) 11th item attempt, (3) Export feature tap, (4) Cloud sync attempt. Monthly/annual toggle with clear pricing.",
        "restoration": "Restore purchases button in Settings and on paywall. Calls Purchases.restorePurchases(). Shows loading state, success toast, or error message.",
        "error_handling": "Network errors show retry option. User cancellation dismissed silently. Billing errors display plain-language message with support contact. All errors logged to analytics."
      }
    },
    "security_privacy": {
      "data_encryption": {
        "at_rest": "AsyncStorage uses platform encryption (iOS Keychain, Android EncryptedSharedPreferences via Expo SecureStore for sensitive data). Images stored in app sandbox.",
        "in_transit": "All network requests use HTTPS/TLS 1.3. Firebase SDK handles certificate pinning. No custom networking bypasses secure channels.",
        "key_management": "RevenueCat API keys stored in environment variables (not hardcoded). No secrets in source code. Firebase config in google-services.json / GoogleService-Info.plist."
      },
      "privacy_compliance": {
        "data_minimization": "Collect only: item details user provides, receipt/product images, notification preferences. No location, contacts, or unnecessary identifiers.",
        "user_consent": "Permission prompts explain purpose (camera for receipts, notifications for alerts). Settings allows revoking permissions. Privacy policy linked in Settings.",
        "data_export": "Premium feature: Export all data as PDF. Free users can screenshot individual items. Full data export available on request per GDPR."
      },
      "api_security": {
        "authentication": "Guest-first with anonymous Firebase Auth. Optional sign-in for cloud sync. No required registration.",
        "authorization": "Firestore rules enforce user isolation. Users can only read/write their own documents. Entitlement verified server-side for premium operations.",
        "rate_limiting": "Firebase handles rate limiting. Client implements exponential backoff for failed requests."
      }
    },
    "performance_optimization": {
      "app_startup": {
        "target_time": "<2 seconds to interactive dashboard",
        "optimization_strategies": [
          "Lazy load Settings and Paywall screens",
          "Load item list from AsyncStorage in parallel with UI render",
          "Minimize bundle size with tree shaking",
          "Use Hermes engine (default in SDK 52)",
          "Preload subscription status during splash"
        ]
      },
      "memory_management": {
        "image_optimization": "Compress receipt images to max 1MB before storage. Use expo-image for efficient loading with caching. Lazy load images off-screen. Release image memory on screen unmount.",
        "component_lifecycle": "Use useMemo/useCallback for expensive computations. Implement virtualized FlatList for dashboard. Avoid anonymous functions in render.",
        "memory_leaks_prevention": "Cleanup subscriptions in useEffect return. Cancel pending image loads on unmount. Use weak references for image cache."
      },
      "network_optimization": {
        "caching_strategy": "Firebase SDK handles document caching. Images cached locally after first load. Subscription status cached for 5 minutes.",
        "request_batching": "Batch item syncs during cloud backup. Single request for initial data fetch. Debounce user edits before sync.",
        "offline_queue": "Queue failed uploads (images, items) with AsyncStorage. Process queue on app resume and network restore. Retry with exponential backoff."
      }
    },
    "platform_integrations": {
      "ios_specific": {
        "features": ["Haptic feedback on add success", "Share sheet for PDF export", "StoreKit for purchases"],
        "apis_used": ["expo-haptics", "expo-sharing", "react-native-purchases (StoreKit 2)"],
        "permissions": ["NSCameraUsageDescription", "NSPhotoLibraryUsageDescription", "NSUserNotificationsUsageDescription"]
      },
      "android_specific": {
        "features": ["Material You theming support", "Share intent for PDF export", "Play Billing for purchases"],
        "apis_used": ["expo-sharing", "react-native-purchases (Play Billing)"],
        "permissions": ["android.permission.CAMERA", "android.permission.READ_EXTERNAL_STORAGE", "android.permission.POST_NOTIFICATIONS"]
      },
      "cross_platform": {
        "shared_features": ["Camera capture", "Local notifications", "Subscription management", "Offline storage", "Image viewer with zoom"],
        "platform_abstractions": ["expo-image-picker (camera abstraction)", "expo-notifications (notification abstraction)", "react-native-purchases (billing abstraction)", "expo-file-system (storage abstraction)"]
      }
    },
    "development_workflow": {
      "build_system": "eas_build",
      "testing_strategy": {
        "unit_tests": "Jest for utility functions (date calculations, item validation, storage helpers). Mock AsyncStorage and RevenueCat SDK.",
        "integration_tests": "React Native Testing Library for component integration. Test add item flow, dashboard rendering, paywall display.",
        "e2e_tests": "Detox for critical user flows: onboarding, add first item, subscription purchase, restore purchases."
      },
      "deployment": {
        "staging": "EAS Build with internal distribution profile. TestFlight for iOS, Internal testing track for Android. RevenueCat sandbox environment.",
        "production": "EAS Build production profile. Submit via EAS Submit. RevenueCat production API keys. Staged rollout 10%→50%→100%.",
        "rollback_strategy": "Keep previous build available. EAS Update for OTA JavaScript fixes. Full rebuild required for native issues."
      }
    }
  },
  "standards_compliance": {
    "subscription_store_compliance": {
      "requirement": "RevenueCat integration, entitlement-based access, restore purchases",
      "implementation": "RevenueCat SDK 9.x with single 'premium' entitlement. Restore purchases in Settings and paywall. Clear pricing disclosure with auto-renewal terms."
    },
    "accessibility_design": {
      "requirement": "WCAG 2.1 AA, 44pt touch targets, VoiceOver/TalkBack support",
      "implementation": "System fonts with Dynamic Type. 4.5:1 contrast. Touch targets ≥44pt. All images have alt text. Form labels properly associated."
    },
    "privacy_analytics": {
      "requirement": "Data minimization, privacy policy, analytics opt-out",
      "implementation": "Collect only user-provided data. Privacy policy in Settings. No tracking without consent. Firebase Analytics with anonymous events."
    },
    "testing_release": {
      "requirement": "Unit tests, integration tests, accessibility tests, sandbox testing",
      "implementation": "Jest unit tests. RTL integration tests. Detox E2E. RevenueCat sandbox testing before production."
    }
  }
}
