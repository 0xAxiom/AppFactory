/**
 * {{Server Name}}
 * {{Server Description}}
 * Generated by Plugin Factory v1.0
 */

import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import { z } from 'zod';

// Server configuration
const CONFIG = {
  name: '{{server-name}}',
  version: '1.0.0',
};

// Initialize MCP server
const server = new McpServer({
  name: CONFIG.name,
  version: CONFIG.version,
});

// =============================================================================
// TOOLS
// =============================================================================

/**
 * {{Tool Name}}
 * {{Tool Description}}
 */
server.tool(
  '{{tool-name}}',
  '{{Tool description for LLM}}',
  {
    // Define input parameters with Zod schemas
    param1: z.string().describe('{{Parameter 1 description}}'),
    param2: z.number().optional().describe('{{Optional parameter description}}'),
  },
  async ({ param1, param2 }) => {
    try {
      // Tool implementation
      console.error(`[${CONFIG.name}] {{tool-name}} called with:`, { param1, param2 });

      // TODO: Add your implementation here
      const result = `Processed: ${param1}`;

      return {
        content: [
          {
            type: 'text',
            text: result,
          },
        ],
      };
    } catch (error) {
      console.error(`[${CONFIG.name}] Error in {{tool-name}}:`, error);
      return {
        content: [
          {
            type: 'text',
            text: `Error: ${error instanceof Error ? error.message : 'Unknown error'}`,
          },
        ],
        isError: true,
      };
    }
  }
);

// =============================================================================
// RESOURCES (Optional)
// =============================================================================

/**
 * {{Resource Name}}
 * {{Resource Description}}
 */
server.resource(
  '{{resource-uri}}',
  '{{Resource description}}',
  async () => {
    try {
      // TODO: Add your resource implementation here
      const data = { example: 'data' };

      return {
        contents: [
          {
            uri: '{{resource-uri}}',
            mimeType: 'application/json',
            text: JSON.stringify(data, null, 2),
          },
        ],
      };
    } catch (error) {
      console.error(`[${CONFIG.name}] Error fetching resource:`, error);
      throw error;
    }
  }
);

// =============================================================================
// PROMPTS (Optional)
// =============================================================================

/**
 * {{Prompt Name}}
 * {{Prompt Description}}
 */
server.prompt(
  '{{prompt-name}}',
  '{{Prompt description}}',
  {
    topic: z.string().describe('{{Topic parameter description}}'),
  },
  async ({ topic }) => {
    return {
      messages: [
        {
          role: 'user',
          content: {
            type: 'text',
            text: `{{Prompt template with ${topic}}}`,
          },
        },
      ],
    };
  }
);

// =============================================================================
// SERVER STARTUP
// =============================================================================

async function main() {
  // Set up graceful shutdown
  process.on('SIGTERM', () => {
    console.error(`[${CONFIG.name}] SIGTERM received, shutting down`);
    process.exit(0);
  });

  process.on('SIGINT', () => {
    console.error(`[${CONFIG.name}] SIGINT received, shutting down`);
    process.exit(0);
  });

  // Connect to transport
  const transport = new StdioServerTransport();
  await server.connect(transport);

  console.error(`[${CONFIG.name}] MCP server v${CONFIG.version} running on stdio`);
}

main().catch((error) => {
  console.error(`[${CONFIG.name}] Fatal error:`, error);
  process.exit(1);
});
